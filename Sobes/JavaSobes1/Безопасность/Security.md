### **Actuator**
**Spring Boot Actuator** - модуль, который добавляет готовые endpoint-ы для **мониторинга** и **управления** приложением.

| Возможность            | Для чего                                       |
| ---------------------- | ---------------------------------------------- |
| `/health`              | Liveness / Readiness Probes в Kubernetes       |
| `/metrics`             | Сбор метрик в Prometheus / Grafana             |
| `/env`, `/configprops` | Отладка приложения на лету                     |
| `/loggers`             | Включение DEBUG логов без перезапуска          |
| `/shutdown`            | (опционально) Завершение приложения через HTTP |

### **Spring Secrurity**
Процесс **`SpringSecurity`:** 
Приходит HTTP запрос -> Попадает в веб-сервер-Tomcat и передаётся уже Spring Boot  -> Проходит через цепь фильтров (FilterChain) Spring Security:
`FilterChain`.
1) проверка аунтификации (Auntification Filter). Проверяет *удостоверение личности*, будь то логин/пароль, токе, куки. Если не то кидает - 401 Unauthorized.
2) проверка авторизации (Authorization Filter). Проверка прав доступа. Если нет, то кидает - 403 Forbidden. 
3) CSRF-фильтр (если включён). Для POST/PUT/DELETE - защита от межсайтовой подделки запросов. Вместе с запросом приходит специальный токен, фронт отправляет его вместе с самим запросом. Если нет, или токен неправильный, то кидает - 401 Unauthorized или 403 Forbidden, соответственно.
4) после всех проверок - запрос отправляется к контроллеру. 

Эта цепочка управляется классом `FilterChainProxy`. Менять порядок и структуру фильтров позволяет класс - `SecurityFilterChain`.

### **Access and Refresh token**

`JWT (JSON Web Token)` - используется для того, чтобы каждый раз не передавать данные пользователя.
Имеет ограниченное время жизни (15 минут). Не хранится в БД. Передаётся либо в теле, либо в заголовке запроса. 
Структура - состоит из трех закодированный строк, разделенных точкой:
- `header` - алгоритм шифрования и тип токена:
```JSON
{
	"alg": "RSA256",
	"type": "JWT"
}
```
- `payload` - данные токена. Время жизни, время создания, его id, и т.д..
- `signature` - строка полученная из частей токена (`header` +`.`+ `payload`, плюс секрертный ключ)
`signature` = получается из `header` и `payload` которые кодируются при помощи секретного ключа (хранится на сервере).

Виды `JWT`-токена:
`Access token` - используется для получения доступа к ресурсам. Короткий строк жизни. Многоразовый. Присылается при каждом запросе в заголовке `Authorization`.
Если срок годности вышел, то сервер возвращает - 401.

`Refresh token` - используется для получения нового `Access`,`Refresh` токена. Хранится долго (несколько дней) и безопасно. Отправляется клиентом на эндпоинт: `./auth/refresh`, по истечению срока годности токена.

План действий:
1) Пользователь логинится (кидает серверу логин, пароль) 
2) Сервер производит аунтификацию клиента, и генерирует токены(A и R).
3) Сервер посылает токены клиенту.
4) Клиент хранит токен у себя `Access` в `localStorage`, `Refresh` в `Cookie`.
5) При каждом запросе передаёт токен.
6) Сервер проверяет токен, определяет пользователя и его права.
7) Если `Access` токен устарел, то сервер возвращает клиенту 401.
8) После 401 клиент понимает что токен устарел и отправляет `Refresh` токен серверу на обновление `Access` токена, а так же генерируется новый `Refresh` токен. 
 
4 18 46 52 53 55 56